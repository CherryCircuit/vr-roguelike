<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Synthwave VR Blaster</title>
  <style>
    /* ── Base Reset & Synthwave Theme ── */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #0a0015;
      color: #ff00ff;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }

    /* ── Info Overlay ── */
    #info {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      z-index: 100;
      pointer-events: none;
    }

    #info h1 {
      font-size: 2.2em;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff, 0 0 30px #00ffff, 0 0 60px #0066ff;
      letter-spacing: 0.15em;
    }

    #info p {
      margin-top: 8px;
      font-size: 1em;
      color: #ff00ff;
      text-shadow: 0 0 8px #ff00ff;
      opacity: 0.8;
    }

    /* ── WebXR Fallback ── */
    #no-vr {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 200;
      background: rgba(10, 0, 21, 0.95);
      border: 1px solid #ff00ff;
      padding: 40px;
      max-width: 500px;
      box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
    }

    #no-vr h2 {
      color: #ff00ff;
      text-shadow: 0 0 10px #ff00ff;
      margin-bottom: 15px;
    }

    #no-vr p {
      color: #aa66cc;
      line-height: 1.6;
    }

    /* ── Scanline Overlay (CRT effect on webpage only) ── */
    #scanlines {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.08) 0px,
        rgba(0, 0, 0, 0.08) 1px,
        transparent 1px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 50;
    }

    /* ── Style the VR button (Three.js injects it) ── */
    #VRButton {
      font-family: 'Courier New', monospace !important;
      letter-spacing: 0.1em !important;
    }
  </style>
</head>
<body>

  <!-- Info overlay shown before entering VR -->
  <div id="info">
    <h1>SYNTHWAVE VR BLASTER</h1>
    <p>Put on your VR headset and press ENTER VR</p>
    <p style="font-size: 0.8em; opacity: 0.5; margin-top: 4px;">Pull triggers to shoot</p>
    <p style="font-size: 0.7em; opacity: 0.4; margin-top: 12px;">ver. 0.023</p>
  </div>

  <!-- Fallback if WebXR is not available -->
  <div id="no-vr">
    <h2>VR NOT AVAILABLE</h2>
    <p>WebXR is not supported on this device or browser.</p>
    <p>Please use a WebXR-compatible browser such as Meta Quest Browser or Chrome on a VR-capable device.</p>
  </div>

  <!-- CRT scanline overlay (hidden in VR — obscures view) -->
  <div id="scanlines"></div>

  <!-- Debug menu (show with ?debug=1 or click DEBUG) -->
  <div id="debug-panel" style="display:none;position:fixed;bottom:20px;left:20px;z-index:150;background:rgba(10,0,21,0.95);border:1px solid #00ffff;padding:12px;font-size:14px;">
    <div style="color:#00ffff;margin-bottom:8px;">DEBUG</div>
    <label>Jump to level: <input type="number" id="debug-level" min="1" max="20" value="5" style="width:40px;background:#220044;color:#fff;border:1px solid #ff00ff;"></label>
    <button id="debug-jump" style="margin-left:8px;background:#220044;color:#00ffff;border:1px solid #00ffff;cursor:pointer;padding:4px 8px;">Jump</button>
    <label style="display:block;margin-top:8px;"><input type="checkbox" id="debug-perf-monitor"> Performance monitor</label>
    <label style="display:block;margin-top:8px;"><input type="checkbox" id="debug-console"> Console log</label>
    <button id="debug-copy-log" style="display:block;margin-top:8px;background:#220044;color:#00ffff;border:1px solid #00ffff;cursor:pointer;padding:4px 8px;width:100%;">Copy Log to Clipboard</button>
  </div>
  <a href="#" id="debug-toggle" style="position:fixed;bottom:10px;left:10px;z-index:140;color:#666;font-size:12px;text-decoration:none;">DEBUG</a>

  <!-- Console log output panel (only visible when enabled) -->
  <div id="console-panel" style="display:none;position:fixed;bottom:80px;left:20px;width:500px;max-height:300px;overflow-y:auto;z-index:150;background:rgba(10,0,21,0.95);border:1px solid #ff00ff;padding:12px;font-size:12px;font-family:monospace;">
    <div style="color:#ff00ff;margin-bottom:4px;">CONSOLE OUTPUT</div>
    <div id="console-logs" style="color:#00ffff;word-break:break-all;"></div>
  </div>

  <!-- WebXR Polyfill (loaded before Three.js) -->
  <script src="https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.min.js"></script>
  <script>
    // Initialize the WebXR polyfill for browsers that don't natively support WebXR
    if (window.WebXRPolyfill) {
      new WebXRPolyfill();
    }
  </script>

  <!-- Three.js module import map (no build tools needed) -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
      "@supabase/supabase-js": "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"
    }
  }
  </script>

  <!-- Main game module -->
  <script type="module" src="main.js"></script>
  <script>
    (function() {
      const params = new URLSearchParams(location.search);
      const panel = document.getElementById('debug-panel');
      const toggle = document.getElementById('debug-toggle');
      const consolePanel = document.getElementById('console-panel');
      const consoleLogs = document.getElementById('console-logs');
      if (params.get('debug') === '1') panel.style.display = 'block';
      toggle.addEventListener('click', function(e) { e.preventDefault(); panel.style.display = panel.style.display === 'none' ? 'block' : 'none'; });
      document.getElementById('debug-jump').addEventListener('click', function() {
        const level = parseInt(document.getElementById('debug-level').value, 10) || 1;
        window.debugJumpToLevel = Math.max(1, Math.min(20, level));
      });
      document.getElementById('debug-perf-monitor').addEventListener('change', function() {
        window.debugPerfMonitor = this.checked;
      });
      document.getElementById('debug-console').addEventListener('change', function() {
        consolePanel.style.display = this.checked ? 'block' : 'none';
      });
      consolePanel.addEventListener('click', function() {
        consolePanel.style.display = 'none';
      });

      document.getElementById('debug-copy-log').addEventListener('click', function() {
        const logText = consoleLogs.innerText;
        navigator.clipboard.writeText(logText).then(() => {
          const btn = document.getElementById('debug-copy-log');
          const originalText = btn.textContent;
          btn.textContent = 'Copied!';
          btn.style.background = '#004400';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '#220044';
          }, 1500);
        }).catch(err => {
          console.error('Failed to copy log:', err);
        });
      });

      const originalLog = console.log;
      const originalError = console.error;
      const originalWarn = console.warn;
      const originalInfo = console.info;
      const originalDebug = console.debug;
      
      console.log = function() {
        originalLog.apply(console, arguments);
        if (document.getElementById('debug-console').checked) {
          const message = Array.from(arguments).map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
          const div = document.createElement('div');
          div.style.color = '#00ffff';
          div.textContent = `[LOG] ${message}`;
          consoleLogs.appendChild(div);
          consoleLogs.scrollTop = consoleLogs.scrollHeight;
          if (consoleLogs.children.length > 100) {
            consoleLogs.removeChild(consoleLogs.firstChild);
          }
        }
      };
      
      console.error = function() {
        originalError.apply(console, arguments);
        if (document.getElementById('debug-console').checked) {
          const message = Array.from(arguments).map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
          const div = document.createElement('div');
          div.style.color = '#ff4444';
          div.textContent = `[ERROR] ${message}`;
          consoleLogs.appendChild(div);
          consoleLogs.scrollTop = consoleLogs.scrollHeight;
          if (consoleLogs.children.length > 100) {
            consoleLogs.removeChild(consoleLogs.firstChild);
          }
        }
      };
      
      console.warn = function() {
        originalWarn.apply(console, arguments);
        if (document.getElementById('debug-console').checked) {
          const message = Array.from(arguments).map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
          const div = document.createElement('div');
          div.style.color = '#ffff44';
          div.textContent = `[WARN] ${message}`;
          consoleLogs.appendChild(div);
          consoleLogs.scrollTop = consoleLogs.scrollHeight;
          if (consoleLogs.children.length > 100) {
            consoleLogs.removeChild(consoleLogs.firstChild);
          }
        }
      };
      
      console.info = function() {
        originalInfo.apply(console, arguments);
        if (document.getElementById('debug-console').checked) {
          const message = Array.from(arguments).map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
          const div = document.createElement('div');
          div.style.color = '#44ffff';
          div.textContent = `[INFO] ${message}`;
          consoleLogs.appendChild(div);
          consoleLogs.scrollTop = consoleLogs.scrollHeight;
          if (consoleLogs.children.length > 100) {
            consoleLogs.removeChild(consoleLogs.firstChild);
          }
        }
      };
      
      console.debug = function() {
        originalDebug.apply(console, arguments);
        if (document.getElementById('debug-console').checked) {
          const message = Array.from(arguments).map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ');
          const div = document.createElement('div');
          div.style.color = '#888888';
          div.textContent = `[DEBUG] ${message}`;
          consoleLogs.appendChild(div);
          consoleLogs.scrollTop = consoleLogs.scrollHeight;
          if (consoleLogs.children.length > 100) {
            consoleLogs.removeChild(consoleLogs.firstChild);
          }
        }
      };
    })();
  </script>

</body>
</html>
